<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scriptify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="../assets/css/forum.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body>
    <!-- header starting -->
    <header>
        <div>
            <h2>Scryptify</h2>
        </div>
        <nav>
            <a href="../course/course.html"><button>Home</button></a>
            <a href="#"><button>About</button></a>
            <a href="../profile/profile.html"><button>Profile</button></a>
        </nav>
    </header>

    <div class="mainDiv">
        <aside>
            <a href="#">Questions</a>
            <a href="#">Tags</a>
            <a href="">Users</a>
            <a href="">Your Answers</a>
        </aside>
        <main>
            <h3 id="head"></h3>
            <caption>asked today</caption>
            <caption>modified today</caption>
            <caption>viewed 26 times</caption>
            <hr>
            <p id="desc"></p>
            <div class="selectedTags">
                <a href="">MySql</a>
                <a href="">Sql</a>
                <a href="">Hacking</a>
            </div>
            <hr>
            <div class="answersSection">
                <h3 id="YourAnswerDiv"></h3>
                <div class="answeredSection">

                </div>


                <hr>
                <h3>Your Answer</h3>
                <form id="yourAnswer">
                    <div class="mb-3">
                        <textarea class="form-control" id="answerText" rows="3" required></textarea>
                    </div>
                    <button class="btn btn-info">Post Your Answer</button>
                </form>
                <p>Not the answer you're looking for? Browse other questions tagged <a href="">MySql</a><a
                        href="">Sql</a><a href="">Hacking</a></p> or <button type="button" class="btn btn-warning">Ask
                    your own question</button>
            </div>

        </main>
        <div id="rightsidebar">
            <div class="SideBar">
                <div class="titleHead"><strong>Watch tags</strong></div>
                <div class="tags">
                    <a href="">artificial-intelligence</a>
                    <a href="">css</a>
                    <a href="">database</a>
                    <a href="">html</a>
                    <a href="">html</a>
                    <a href="">javascript</a>
                    <a href="">linux</a>
                    <a href="">python</a>
                </div>
            </div>
            <div class="SideBar">
                <div class="titleHead"><strong>Custom Filters</strong></div>
                <div class="tags">
                    <a href="">Create a custom filter</a>
                </div>
            </div>
            <div class="SideBar">
                <div class="titleHead"><strong>Ignored Tags</strong></div>
                <div class="tags">
                    <a href="">Add an ignored tag</a>
                </div>
            </div>
        </div>
    </div>
    <script>

        let url = window.location.search
        let search = new URLSearchParams(url)
        let id = search.get("id")

        let forum_arr = JSON.parse(localStorage.getItem("forum"))
        let head = document.getElementById("head")
        let desc = document.getElementById("desc")
        let answersStorage;


        let forum_obj = forum_arr.find(function (obj) {
            if (id === obj["id"] + "") {
                return true
            }
            else {
                return false
            }
        })
        head.innerText = forum_obj["questionName"]
        desc.innerText = forum_obj["questionDesc"]


        let userData = JSON.parse(localStorage.getItem("userData"))
        let profile = JSON.parse(localStorage.getItem("profile"))
        let yourAnswer = document.getElementById("yourAnswer")
        let answerUserTyped;
        let profileName;
        let forum = JSON.parse(localStorage.getItem("forum"))
        let answerId = Math.floor(Math.random() * 100);

        userData.find(e => {
            if (e["email"] == profile["email"]) {
                profileName = e["firstname"]
            }
        })

        yourAnswer.addEventListener("submit", function (e) {
            e.preventDefault()
            if (localStorage.getItem("forum")) {
                forum = JSON.parse(localStorage.getItem("forum"))
            }
            // else {
            //     answer_arr = []
            // }
            answerUserTyped = document.getElementById("answerText").value
            answersStorage = {
                "answeredBy": profileName,
                "answer": answerUserTyped,
            }
            for (let i = 0; i < forum.length; i++) {
                //     if (heading == forum[i]["questionName"]) {
                //         //     answersStorage = {
                //         //     "answer": answerUserTyped,
                //         // }
                //         forum[i]["answer"].push(answerUserTyped)
                //     }
                forum[i]["answer"].push(answersStorage)
                localStorage.setItem("forum", JSON.stringify(forum))
                location.reload()
            }
            // forum.push(answersStorage)


        })
        forum.find((e) => {
            // finding user with id
            if (e["id"] == id) {
                // finding answer
                e["answer"].find((el) => {

                    // Appending div
                    const answeredSection = document.createElement("div");
                    answeredSection.classList.add("answeredSection");

                    const strong = document.createElement("strong");
                    strong.textContent = `Answered by ${el["answeredBy"]}`;
                    answeredSection.appendChild(strong);


                    const voteSection = document.createElement("div")
                    voteSection.setAttribute("class", "voteSection")
                    answeredSection.appendChild(voteSection)

                    const p = document.createElement("p");
                    p.textContent = el["answer"];
                    voteSection.appendChild(p);

                    const like = document.createElement("button");
                    like.setAttribute("id", "likeBtn")
                    voteSection.appendChild(like);

                    const likeIcon = document.createElement("i");
                    likeIcon.setAttribute("class", "fa-regular fa-thumbs-up")
                    likeIcon.setAttribute("id", "likeIcon")
                    like.appendChild(likeIcon);

                    document.querySelector(".answeredSection").appendChild(answeredSection)
                  
                })
            }
        })

        const likeBtn = document.querySelectorAll("#likeBtn")
        const likeIcon = document.querySelectorAll("#likeIcon")
        let likeCount = 0
        likeIcon.forEach(e => {
            e.addEventListener("click", function (el) {

                if (el.target.style.color == "blue") {

                    e.classList.remove("fa-solid")
                    e.style.color = null
                    likeCount--

                }
                else {
                    e.classList.add("fa-solid")
                    e.style.color = "blue"
                    likeCount++


                }
                console.log(likeCount);
            })
        })







    </script>

</body>

</html>